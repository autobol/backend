.deploy_teamplate: &deploy_teamplate
  stage: deploy
  script:
    - sed -i "s/NAMESPACE/$NAMESPACE/g" ./app-deploy-chart/values.yaml
    - sed -i "s/TAG/$TAG/g" ./app-deploy-chart/values.yaml
    - helm upgrade $APP_CHART app-deploy-chart

Deploy_dev:
  needs:
    - Build_dev
  environment: dev
  tags:
    - aws_dev_deploy
  <<: *deploy_teamplate

Deploy_prod:
  needs:
    - Build_prod
    - Deploy_dev
  environment: prod
  tags:
    - aws_prod_deploy
  when: manual
  <<: *deploy_teamplate
