.build_temaplte: &build_template
  stage: build
  tags:
    - docker
  services:
    - docker:19.03.12-dind
  image: docker
  script:
    - sed -i "s/NAMESPACE/$NAMESPACE/g" ./src/main/resources/application.yaml
    - sed -i "s/DB_CHART/$DB_CHART/g" ./src/main/resources/application.yaml
    - sed -i "s/DB_NAME/$DB_NAME/g" ./src/main/resources/application.yaml
    - sed -i "s/DB_USER/$DB_USER/g" ./src/main/resources/application.yaml
    - sed -i "s/DB_PASS/$DB_PASS/g" ./src/main/resources/application.yaml
    - docker build `
     `-t $DOCKER_REGISTRY/backend:$TAG `
     `--build-arg GRADLE_VERSION=$GRADLE_VERSION .
    - echo $DOCKER_PASS | docker login -u $DOCKER_USER --password-stdin
    - docker push $DOCKER_REGISTRY/backend:$TAG
